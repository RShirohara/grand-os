# yaml-language-server: $schema=https://schema.blue-build.org/module-list-v1.json

modules:
  # Apply file-based customizations.
  - type: "files"
    files:
      - source: "./system/common"
        destination: "/"

  # Add grand-os image info.
  - type: "script"
    scripts:
      - "./add-image-info.sh"

  # Add default kargs to bootc config.
  - type: "script"
    scripts:
      - "./apply-default-kargs.sh"

  # Change rebase-image refs on securebluecleanup script.
  - type: "script"
    scripts:
      - "./update-cleanup-refs.sh"

  # Apply GTK theme customization.
  - type: "gschema-overrides"
    include:
      - "zz2-grand-os.gschema.override"
  - type: "script"
    snippets:
      # Apply GTK Theme.
      - "echo 'GTK_THEME=WhiteSur-Dark' >> /etc/environment"
      # Apply GDM theme.
      - "
        cp
        /usr/share/themes/WhiteSur-Extension/gdm/gnome-shell-theme.gresource
        /usr/share/gnome-shell/
        "
      # Apply gnome extension `dash-to-dock` theme.
      - "
        cp
        /usr/share/themes/WhiteSur-Extension/dash-to-dock/stylesheet.css
        /usr/share/gnome-shell/extensions/dash-to-dock@micxgx.gmail.com/
        "

  # Apply KDE theme customization.
  - type: "script"
    snippets:
      # Apply customization to WhiteSur Kvantum theme.
      - "
        sed
        --expression='s|^transparent_dolphin_view=.*|transparent_dolphin_view=false|'
        --expression='s|^scrollbar_in_view=.*|scrollbar_in_view=true|'
        --in-place /usr/share/Kvantum/WhiteSur/WhiteSur*.kvconfig
        "

  # Enable systemd units.
  - type: "systemd"
    system:
      enabled:
        - "keyd.service"
    user:
      enabled:
        - "flatpak-override-update.timer"
        - "gnupg-unit-update.timer"
